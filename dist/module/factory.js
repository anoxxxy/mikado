import Mikado,{includes}from"./mikado.js";import{listen}from"./event.js";export function create_path(a,b,c){const d=b.length,e=[],f={};for(let g,h,i,j,k,l=0,m=null;l<d;l++)g=b[l],h=g.v,h?(j=i=f[h],!j&&(i=resolve(a,h,f),j=i[0],i=i[1]||j)):j=i=a,c&&k!==i&&(k=i,i._mkc=m={}),e[l]=new Cache(m,j,"");return a._mkp=e,e}function resolve(a,b,c){let d;for(let e=0,f=b.length,g="";e<f;e++){const f=b[e];g+=f,c[g]?a=c[g]:(">"===f?a=a.firstChild:"|"===f?(d=a,a=a.firstChild):"@"===f?(d=a,a=a.style):a=a.nextSibling,c[g]=a)}return[a,d]}export function construct(a,b,c,d,e,f){const g=d||(a.tag?a.svg?document.createElementNS("http://www.w3.org/2000/svg",a.tag):document.createElement(a.tag):document.createTextNode(a.text));let h,j;if((j=a.class)&&("object"==typeof j?(b.push(new Cache(h={_c:""},g,c)),(j=j[0])&&init_proxy.call(e,j,["_c",b.length-1])):!d&&(g.className=j)),j=a.attr)for(const a in j){let f=j[a];"object"==typeof f?(h||b.push(new Cache(h={},g,c)),h["_a"+a]=!1,(f=f[0])&&init_proxy.call(e,f,["_a",b.length-1,a])):!d&&g.setAttribute(a,f)}if(j=a.event)for(const a in j)d||(g.setAttribute(a,j[a]),listen(a));if((j=a.style)&&("object"==typeof j?(b.push(new Cache(h||(h={}),g.style,c+"@")),h._s="",(j=j[0])&&init_proxy.call(e,j,["_s",b.length-1])):!d&&(g.style.cssText=j)),j=a.text){if("object"==typeof j){let f=g;j=j[0],a.tag?(c+="|",f=!d&&g.firstChild,!f&&(f=document.createTextNode(j),g.appendChild(f))):h={},(h||(h={}))._t=j,b.push(new Cache(h,f,c)),j&&init_proxy.call(e,j,["_t",b.length-1])}else d||(a.tag?g.textContent=j:g.nodeValue=j);}else if(j=a.child){d&&(d=d.firstChild),j.constructor!==Array&&(j=[j]);for(let a,f=0,h=j.length;f<h;f++){a=j[f],c+=f?"+":">";const i=construct(a,b,c,d,e,1);d?f<h-1&&(d=d.nextSibling):g.appendChild(i)}}else if(j=a.html)"object"==typeof j?(h||b.push(new Cache(h={},g,c)),h._h="",(j=j[0])&&init_proxy.call(e,j,["_h",b.length-1])):!d&&(g.innerHTML=j);else if(j=a.inc){h||b.push(new Cache(null,g,c));let a;if("string"!=typeof j){const b=e.inc.length;j=j;const c={name:e.name+"|"+b,tpl:j,key:j.key,cache:j.cache,fn:e.tpl._fn},f={recycle:e.recycle,cache:e.cache,pool:e.pool,state:e.state,mount:g,hydrate:!!d};a=new Mikado(c,f)}else if(a=includes[j],!(a instanceof Mikado)){const b=a[0],c=a[1];c&&(c.async=!1,d&&(c.root=d,c.hydrate=!0)),includes[j]=a=new Mikado(b,c)}e.inc.push(a)}return h&&(g._mkc=h),f||(g._mkp=b,e.fullproxy=e.fullproxy===b.length?1:0),g}function init_proxy(a,b){this.fullproxy++,this.proxy||(this.proxy={}),(this.proxy[a]||(this.proxy[a]=[])).push(b)}export let NodeCache;export function Cache(a,b,c){this.c=a,this.n=b,this.v=c}Cache.prototype._a=function(a,b){if(this.c){if(this.c["_a"+a]===b)return;this.c["_a"+a]=b}!1===b?this.n.removeAttribute(a):this.n.setAttribute(a,b)},Cache.prototype._t=function(a){if(this.c){if(this.c._t===a)return;this.c._t=a}this.n.nodeValue=a},Cache.prototype._c=function(a){if(this.c){if(this.c._c===a)return;this.c._c=a}this.n.className=a},Cache.prototype._s=function(a){if(this.c){if(this.c._s===a)return;this.c._s=a}this.n.cssText=a},Cache.prototype._h=function(a){if(this.c){if(this.c._h===a)return;this.c._h=a}this.n.innerHTML=a},Cache.prototype._a,Cache.prototype._t,Cache.prototype._s,Cache.prototype._c,Cache.prototype._h;