const event_types={tap:1,change:1,click:1,dblclick:1,input:1,keydown:1,keypress:1,keyup:1,mousedown:1,mouseenter:1,mouseleave:1,mousemove:1,mouseout:1,mouseover:1,mouseup:1,mousewheel:1,touchstart:1,touchmove:1,touchend:1,touchcancel:1,reset:1,select:1,submit:1,toggle:1,blur:1,error:1,focus:1,load:1,resize:1,scroll:1};function escape_single_quotes(a){return a.replace(/\\([\s\S])|(')/ig,"\\$1$2")}function escape_single_quotes_expression(a){return a.replace(/{{(.*)?(\\)?([\s\S])|(')(.*)?(}})/ig,"{{$1$2$3$4$5$6")}function replaceComments(a){return a.replace(/<!--(.*?)-->/g,"")}let message=0,counter=0;export default function compile(a,b,c,d,e,f){if(!1,b)return new Promise(function(c){const d=compile(a);"function"==typeof b&&b(d),c(d)});e||(d=[],c=[d],d.index=e={current:-1,count:0,last:-1,inc:0,included:!1});const g=f?{}:{tpl:{}},h=f?g:g.tpl;if(!f){if("string"==typeof a)if(/<.*>/.test(a)){const b=document.createElement("div");b.innerHTML=a,a=b.firstElementChild}else g.name=a,a=document.getElementById(a);a=a,g.name||(g.name=a.getAttribute("name")||a.id||"tpl-"+counter++),a.content?a=a.content.firstElementChild:"TEMPLATE"===a.tagName&&(a=a.firstElementChild)}const i=a.tagName;if(i)h.tag=i;else{let b;if(a&&(b=a.nodeValue)&&b&&b.trim()){const a=b.indexOf("{{@");if(-1!==a){const c=b.indexOf("}}",a);h.js=b.substring(a+3,c),b=b.substring(0,a)+b.substring(c+2),b&&d.push(b)}b&&b.trim()&&(/{{[!?]?#/.test(b)?handle_value(h,"html",b,!1,null,e,c,d):(e.count++,handle_value(h,"text",b,!1,null,e,c,d)))}return h.js||b&&b.trim()?h:null}let j=a.attributes;if(j.length){const b={};for(let c=0;c<j.length;c++){let d=j[c].nodeName,e=a.getAttribute(d);"foreach"===d&&(d="for"),"include"===d&&(d="inc"),b[d]=e}for(let a in j=b,j){let b,f,i=j[a];switch(a){case"class":case"style":b=a;break;case"offset":a="range",h.range=i;case"limit":a="range",h.range=(h.range||0)+","+i;case"range":h.range=(h.range||i).split(",").map(a=>parseInt(a,10)||0),b=a;break;case"include":a="inc";case"inc":b=a;break;case"if":b=a;break;case"foreach":a="for",b=a;break;case"js":h.js=strip(i);break;case"key":g.key=strip(i).replace("data.","");break;case"cache":break;default:f=event_types[a]?h.event||(h.event={}):h.attr||(h.attr={}),b=a;}b&&handle_value(f||h,b,i,!!f,j,e,c,d)}}const k=a.childNodes,l=k.length;if(e.included&&(e.included=!1,e.inc++,d=[],c.unshift(d),h.child||(h.child=h.text?{text:h.text}:h.html?{html:h.html}:null),l?(d.root=h,d.inc=h.child||(h.child=[]),d.index=e={current:-1,count:0,last:-1,inc:0,included:!1}):d.inc=h.inc,delete h.text,delete h.html,delete h.for),l){for(let a=0;a<l;a++){if(8===k[a].nodeType)continue;e.count++;const b=compile(k[a],null,c,d,e,1);b&&(1!==l||3!==k[a].nodeType&&b.text||h.js&&b.js?(h.child||(h.child=[])).push(b):(b.js&&(h.js=b.js),b.html&&(h.html=b.html),b.text&&(h.text=b.text)))}h.child&&1===h.child.length&&(h.child=h.child[0])}if(!f)if(1===c.length&&0===c[0].length)g.fn=null;else{for(let a=0;a<c.length;a++)c[a].root&&(c[a].root.inc=c[a].inc[0],delete c[a].root.child);for(let a=0;a<c.length;a++)c[a].length?(c[a].unshift("let _o,_v"),c[a]=Function("data","state","index","_p","\"use strict\";"+(c[a].join(";")+";"))):c[a]=null;g.fn=c.length?c:null}return g}function handle_value(a,b,c,d,e,f,g,h){if(/{{[\s\S]+}}/.test(c)){let e=/{{([!?#]+)?=/.test(c),g=/{{!?\?/.test(c),i=/{{\??!/.test(c),j=replaceComments(c);g&&(j=j.replace(/{{[!?]+/g,"{{")),e&&(e=j.replace(/{{#?=+(.*)?}}/ig,"$1").trim().replace(/^data\./,"").replace(/^data\[['"](.*)['"]]/,"$1")),j=j.replace(/{{[#=]+/g,"{{").replace(/"(\s+)?{{(\s+)?/g,"(").replace(/(\s+)?}}(\s+)?"/g,")").replace(/{{(\s+)?/g,"'+(").replace(/(\s+)?}}/g,")+'"),j=("'"+j+"'").replace(/^""\+/g,"").replace(/^''\+/g,"").replace(/\+''$/g,"").replace(/\+""$/g,"").replace(/['"]\)\+''\+\(['"]/g,"").replace(/['"](\s+)?\+(\s+)?['"]/g,"").replace(/^\(([^ ]+)\)$/g,"$1").trim(),g?j="("+(j+"||"+j+"===0?"+(i?d?"this.attr("+j+")":"this.text("+j+")":j)+":'')"):i&&(j=d?"this.attr("+j+")":"this.text("+j+")"),"text"===b&&a.tag&&f.count++,"style"===b&&a.tag&&f.count++,f.count!==f.last&&(f.current++,f.last=f.count,h.push("_o=_p["+f.current+"]")),h.push("_v="+j),d?h.push("if(!_o.c||_o.c[\"_a"+b+"\"]!==_v){_o.c&&(_o.c[\"_a"+b+"\"]=_v);_o.n[_v===false?\"removeAttribute\":\"setAttribute\"](\""+b+"\",_v)}"):"class"===b?h.push("if(!_o.c||_o.c._c!==_v){_o.c&&(_o.c._c=_v);_o.n.className=_v}"):"style"===b?h.push("if(!_o.c||_o.c._s!==_v){_o.c&&(_o.c._s=_v);_o.n.cssText=_v}"):"html"===b?h.push("if(!_o.c||_o.c._h!==_v){_o.c&&(_o.c._h=_v);_o.n.innerHTML=_v}"):"text"==b&&h.push("if(!_o.c||_o.c._t!==_v){_o.c&&(_o.c._t=_v);_o.n.nodeValue=_v}"),a[b]=e?[e]:[""]}else a[b]=c;if(("for"===b||"if"===b||"inc"===b)&&!d&&!f.included){f.count!==f.last&&(f.current++,f.last=f.count,h.push("_o=_p["+f.current+"]"));const b=e.for?e.for.trim()+(e.range?".slice("+(e.range[0]||0)+(e.range[1]?","+((e.range[0]||0)+e.range[1]):"")+")":""):"data";let c=f.inc;e.if?(h.push("this.inc["+c+"].mount(_o.n)["+e.if.trim()+"?\"render\":\"clear\"]("+b+",state)"),f.included=!0):e.for?(h.push("this.inc["+c+"].mount(_o.n).render("+b+",state)"),f.included=!0):(h.push("this.inc["+c+"].mount(_o.n).render(data,state)"),f.included=!0),delete a.for,delete a.range,delete a.if}}function strip(a){return a.replace(/{{/g,"").replace(/}}/g,"").trim()}